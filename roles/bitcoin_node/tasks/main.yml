---
- name: Verify essential values from user_input.yml
  assert:
    fail_msg: "User_input.yml file corrupted and/or missing key information. Re-installing this repository is advised."
    that:
      - bitcoin_node_vars["enabled"]
      - bitcoin_node_vars["data_root"] is defined
      - bitcoin_node_vars["config_dir"] is defined
      - bitcoin_node_vars["full_compile"] is defined
      - bitcoin_node_vars["update_systemd"] is defined
      - bitcoin_node_vars["node_rpc_username"] is defined
      - bitcoin_node_vars["node_rpc_password"] is defined

- name: block device reformat
  when:
    - bitcoin_node_vars["reformat_device"] | default(false) | bool
    - bitcoin_node_vars["device_path"] | regex_search("^\/dev\/")
  include_tasks:
    file: reformat_block_device.yml

- name: bitcoin core compile and install
  include_tasks:
    file: bitcoin_core_compile_install.yml

- name: bitcoin node systemd install
  when: bitcoin_node_vars["update_systemd"] | default(False) | bool
  include_tasks:
    file: bitcoin_systemd_install.yml
